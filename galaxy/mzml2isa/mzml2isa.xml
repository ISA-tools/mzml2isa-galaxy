<tool id="mzml2isa" name="mzml2isa" version="0.1.0">
    <description>Parser to get meta information from mzML files and create an ISA-Tab structure</description>
    
    <macros>
        <import>mzml2isa_macros.xml</import>
    </macros>

    <requirements>
        <requirement type="package" version="0.4.19">mzml2isa</requirement>
    </requirements>

    <stdio>
        <exit_code range="1:" />
    </stdio>
    
    <command interpreter="python"><![CDATA[
    #set $s_submission_date = 0
    #set $s_release_date = 0
    #set $s_publication = 0
    #set $s_description = 0
    #set $s_doi = 0
    #set $s_title = 0
    #set $s_status = 0
    #set $s_author = 0

    #set $s_first_name = 0
    #set $s_mid_initials = 0
    #set $s_last_name = 0
    #set $s_telephone = 0
    #set $s_fax = 0
    #set $s_affiliation = 0
    #set $s_role = 0
    #set $s_mail = 0
    #set $s_address = 0

    #set $i_submission_date = 0
    #set $i_release_date = 0
    #set $i_publication = 0
    #set $i_description = 0
    #set $i_doi = 0
    #set $i_title = 0
    #set $i_status = 0
    #set $i_author = 0

    #set $i_first_name = 0
    #set $i_mid_initials = 0
    #set $i_last_name = 0
    #set $i_telephone = 0
    #set $i_fax = 0
    #set $i_affiliation = 0
    #set $i_role = 0
    #set $i_mail = 0
    #set $i_address = 0

    #set $organism_text = 0
    #set $organism_ref = 0
    #set $organism_iri = 0
    #set $organism_variant_text = 0
    #set $organism_variant_ref = 0
    #set $organism_variant_iri = 0
    #set $organism_part_text = 0
    #set $organism_part_ref = 0
    #set $organism_part_iri = 0


    #if $study_meta.study_select=="show"
    	#set $study_title = $study_meta.study_title
    	#set $submission_date =  $study_meta.s_submission_date
    	#set $s_release_date = $study_meta.s_release_date
        #set $s_description = $study_meta.s_description
    	#set $s_publication = $study_meta.s_publication 
    	#set $s_doi = $study_meta.s_doi  
        #set $s_title = $study_meta.s_title
        #set $s_status = $study_meta.s_status
        #set $s_author = $study_meta.s_author    
    #end if

    #if ($s_contacts.s_contacts_select=="show"):
    	#set $s_first_name = $s_contacts.s_first_name
        #set $s_mid_initials = $s_contacts.s_mid_initials
        #set $s_last_name = $s_contacts.s_last_name
        #set $s_telephone = $s_contacts.s_telephone
        #set $s_fax = $s_contacts.s_fax
        #set $s_affiliation = $s_contacts.s_affiliation
        #set $s_role = $s_contacts.s_role
        #set $s_mail = $s_contacts.s_mail
        #set $s_address = $s_contacts.s_address
    #end if

    #if ($i_contacts.i_contacts_select=="show"):
    	#set $i_first_name = $i_contacts.i_first_name
        #set $i_mid_initials = $i_contacts.i_mid_initials
        #set $i_last_name = $i_contacts.i_last_name
        #set $i_telephone = $i_contacts.i_telephone
        #set $i_fax = $i_contacts.i_fax
        #set $i_affiliation = $i_contacts.i_affiliation
        #set $i_role = $i_contacts.i_role
        #set $i_mail = $i_contacts.i_mail
        #set $i_address = $i_contacts.i_address
    #end if

    #if ($invest_meta.invest_select=="show"):
    	#set $i_submission_date = $invest_meta.i_submission_date
        #set $i_release_date = $invest_meta.i_release_date 
        #set $s_description = $study_meta.s_description
        #set $i_publication = $invest_meta.i_publication
        #set $i_doi = $invest_meta.i_doi
        #set $i_title = $invest_meta.i_title
        #set $i_status = $invest_meta.i_status
        #set $i_author = $invest_meta.i_author
    #end if

    #if ($exp_meta.exp_select=="show"):
    	#set $organism_text = $exp_meta.organism_text
        #set $organism_ref = $exp_meta.organism_ref
        #set $organism_iri = $exp_meta.organism_iri
        #set $organism_variant_text = $exp_meta.organism_variant_text 
        #set $organism_variant_ref = $exp_meta.organism_variant_ref 
        #set $organism_variant_iri = $exp_meta.organism_variant_iri
        #set $organism_part_text = $exp_meta.organism_part_text
        #set $organism_part_ref = $exp_meta.organism_part_ref 
        #set $organism_part_iri = $exp_meta.organism_part_iri
    #end if

    wrapper.py $inputzip 
               $jsontxt 
               $html_file 
               $html_file.extra_files_path 
               $name_of_study 
               $s_submission_date 
               $s_release_date 
               $s_description 
               $s_publication 
               $s_doi 
               $s_title 
               $s_status 
               $s_author 
               $s_first_name 
               $s_mid_initials 
               $s_last_name 
               $s_telephone 
               $s_fax 
               $s_affiliation 
               $s_role 
               $s_mail 
               $s_address  
               $i_submission_date 
               $i_release_date 
               $s_description 
               $i_publication 
               $i_doi 
               $i_title 
               $i_status 
               $i_author 
               $i_first_name 
               $i_mid_initials 
               $i_last_name 
               $i_telephone 
               $i_fax 
               $i_affiliation 
               $i_role 
               $i_mail 
               $i_address 
               $organism_text 
               $organism_ref 
               $organism_iri 
               $organism_variant_text 
               $organism_variant_ref 
               $organism_variant_iri 
               $organism_part_text 
               $organism_part_ref 
               $organism_part_iri]]>
    </command>

    <inputs>
        <param name="name_of_study" type="text" label="Name study" help="" />
        <param format="zip" name="inputzip" type="data" label="mzML zip file"  help="A zipped folder of mzML files"/>
        <param optional="true" format="txt" name="jsontxt" type="data" label="Additional user Metadata in json"  help="A user can add additional metadata directory through a json see link for example format"/>
        <expand macro="studymacro"/>
        <expand macro="investmacro"/>
        <expand macro="expmacro"/>
        <expand macro="scontactmacro"/>
        <expand macro="icontactmacro"/>
    </inputs>
    <outputs>
        <data format="html" name="html_file" label="" />
    </outputs>
    <tests>
        <test>
            <param name="name_of_study" value="test" />
            <param name="inputzip" value="metabolomics_study.zip" />
            <output name="output" value="metabolomics_study/test/index.html" />
        </test>
    </tests>
    <help><![CDATA[
**Overview**

.. image:: mzml2isa.png
    ]]></help>
    <citations>
        <citation type="doi">10.1002/0471250953.bi1413s53</citation>
        <citation type="doi">10.1007/s11306-015-0879-3</citation>
        <citation type="doi">10.1038/ng.1054</citation>
    </citations>
</tool>




